<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="favicon.ico">
	<title>Zeyad Qur'an Follow Up</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<style>
		body, html {
			background-image: url("background.jpg");
			background-color: #ffe59b00;
			background-repeat: no-repeat;
			background-size: cover;
			height: 100%;
			margin: 0%;
		}
		
		.container {		
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		.primary-font-size {
			font-size: 0.6cm;
		}

		.primary-color {
			color: #af8868;
		}

		.center {
			text-align: center;
		}
		
		.w-100 {
			width: 100%
		}
		
		.h-100 {
			height: 100%
		}

		.circled-shadow {
			width: 100%;
			text-align: center;
			font-size: 55px;
			cursor: pointer;
			user-select: none;
			width: 50px;
			height: 50px;
			display: inline-block;
			border-radius: 50%;
  			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
		}

		.sheet {
			width: 1000px;
			height: 30em;
		}

		.shadow {
			box-shadow:
				0 2.8px 2.2px rgba(0, 0, 0, 0.034),
				0 6.7px 5.3px rgba(0, 0, 0, 0.048),
				0 12.5px 10px rgba(0, 0, 0, 0.06),
				0 22.3px 17.9px rgba(0, 0, 0, 0.072),
				0 41.8px 33.4px rgba(0, 0, 0, 0.086),
				0 100px 80px rgba(0, 0, 0, 0.12);
		}
		
		.mt-1 {
			margin-top: 1em;
		}

		.border-rd-5 {
			border-radius: 10px;
		}

		.hide {
			display: none;
		}

		@media only screen and (max-width: 1000px) {
			.sheet {
				width: 900px;
				height: 700px;
			}
		}
		
		@media only screen and (max-width: 900px) {
			.sheet {
				width: 700px;
				height: 700px;
			}
		}

		@media only screen and (max-width: 700px) {
			.sheet {
				width: 600px;
				height: 600px;
			}
		}

		@media only screen and (max-width: 600px) {
			.sheet {
				width: 500px;
				height: 500px;
			}
		}

		@media only screen and (max-width: 400px) {
			.sheet {
				width: 100%;
				height: 300px;
			}
		}
	</style>
</head>
<body>
	<div class="container h-100">
		<div class="primary-color primary-font-size">
			<h1 class="center">Zeyad Qur'an Follow up</h1>
			<h1 class="center">
				<span id="sub" class="circled-shadow hide">-</span>
				<a href="https://docs.google.com/spreadsheets/d/1qpqnAKeXf1B4reFG5JMkpyewtuECPsVOXmIcX3TblNg/edit?usp=sharing" style="text-decoration:none" class="primary-color" target="_blank" id="count">0</a>
				<span id="add" class="circled-shadow hide">+</span>
			</h1>
			<div class="center">
				<i id="reset" class="fa fa-undo circled-shadow hide" style="font-size:36px; vertical-align: super;"></i>
				<i id="notify" class="fa fa-bell circled-shadow hide" style="font-size:36px; vertical-align: super;"></i>
			</div>
			<iframe class="sheet w-100 h-100 shadow border-rd-5 mt-1" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5cnZj92_cimp5057aHeU_URHCMkMziaMMIo-JJ97kUTQFrsb6054ovqpd-KMu6J5sOcPb3Wvz1LA2/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
		</div>
	</div>
</body>
	<script>
		var lessonsCount = 0;
		fetch('./count.txt')
		  .then(response => response.text())
		  .then(count => document.getElementById('count').textContent = lessonsCount = count);

		const owner = "Ahmad-Zaky";
		const repo = "zeyad";
		const PAT = "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";
		const count = '1';
		const addWorkflowId = '80817688';
		const subWorkflowId = '80817689';
		const resetWorkflowId = '80845423';
		const notifyWorkflowId = '80843587';

		var myHeaders = new Headers();
		myHeaders.append("Accept", "application/vnd.github+json");
		myHeaders.append("Authorization", `Bearer ${PAT}`);
		myHeaders.append("X-GitHub-Api-Version", "2022-11-28");
		myHeaders.append("Content-Type", "application/json");

		var raw = JSON.stringify({
			"ref": "main",
			"inputs": {
				"count": count
			}
		});

		var requestOptions = {
			method: 'POST',
			headers: myHeaders,
			body: raw,
			redirect: 'follow'
		};

		// Add Count
		function addCount() {
			fetch(`https://api.github.com/repos/${owner}/${repo}/actions/workflows/${addWorkflowId}/dispatches`, requestOptions)
				.then(response => response.text())
				.then(result => window.location.reload())
				.catch(error => console.log('error', error));
		}
		
		// Subtract Count
		function subCount() {
			fetch(`https://api.github.com/repos/${owner}/${repo}/actions/workflows/${subWorkflowId}/dispatches`, requestOptions)
				.then(response => response.text())
				.then(result => window.location.reload())
				.catch(error => console.log('error', error));
		}
		
		// Reset Count
		function resetCount() {
			fetch(`https://api.github.com/repos/${owner}/${repo}/actions/workflows/${resetWorkflowId}/dispatches`, requestOptions)
				.then(response => response.text())
				.then(result => window.location.reload())
				.catch(error => console.log('error', error));
		}

		// Notify
		function notify() {
			var notifyRaw = JSON.stringify({
				"ref": "main",
				"inputs": {
					"to": "ahmed6mohamed6@gmail.com",
					"msg": `Quran Lessons has reaced ${lessonsCount} lessons`
				}
			});

			var notifyRequestOptions = {
				method: 'POST',
				headers: myHeaders,
				body: notifyRaw,
				redirect: 'follow'
			};

			fetch(`https://api.github.com/repos/${owner}/${repo}/actions/workflows/${notifyWorkflowId}/dispatches`, notifyRequestOptions)
				.then(response => response.text())
				.then(result => window.location.reload())
				.catch(error => console.log('error', error));
		}

		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.has("admin")) {
			const hiddenElements = document.querySelectorAll(".hide");
			for (const element of hiddenElements) {
				element.classList.remove("hide");
			}

			document.getElementById("add").addEventListener("click", function() {
				addCount()
			});
			
			document.getElementById("sub").addEventListener("click", function() {
				subCount()
			});
			
			document.getElementById("reset").addEventListener("click", function() {
				resetCount()
			});

			document.getElementById("notify").addEventListener("click", function() {
				notify()
			});
		}
	</script>
</html>
